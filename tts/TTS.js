const { 
  joinVoiceChannel, VoiceConnectionStatus, entersState, 
  createAudioPlayer, AudioPlayerStatus, createAudioResource, 
  NoSubscriberBehavior, StreamType 
} = require('@discordjs/voice')
const VoiceRSSClient = require("voice-rss-client")
const fs = require("fs")

module.exports = class TTS {
  constructor(key) {
    this.key = key

    // https://discord.js.org/#/docs/main/stable/class/VoiceConnection
    this.connection = {}

    // https://discord.js.org/#/docs/main/stable/class/StreamDispatcher
    this.dispatcher = {}

    this.player = {}

    this.playing = {}
  }

  async joinVoiceChannel(intr){
    try{
      this.connection[intr.guild.id] = joinVoiceChannel({
        channelId: intr.member.voice.channel.id,
        guildId: intr.member.voice.channel.guild.id,
        adapterCreator: intr.member.voice.channel.guild.voiceAdapterCreator,
        selfMute: false,
        selfDeaf: false
      })
      .on('stateChange', (oldState, newState) => {
        if(oldState.status != newState.status)
          console.log(`[ ${intr.guild.name} ] ðŸŽ™ Voice from ${oldState.status} to ${newState.status}`)
      })

      this.player[intr.guild.id] = createAudioPlayer({
        behaviors: {
          noSubscriber: NoSubscriberBehavior.Pause,
        },
      })
      .on('stateChange', (oldState, newState) => {
        console.log(`[ ${intr.guild.name} ] ðŸŽ™ Audio player from ${oldState.status} to ${newState.status}`)
        if(newState.status === "idle"){ 
          this.playing[intr.guild.id] = null; 
          // this.player[intr.guild.id].stop()
        }
      })
      .on('error', error => {
        console.error(`Error: ${error.message} with resource ${error.resource.metadata.title}`);
        this.connection[intr.guild.id].destroy()
      })  
      await entersState(this.connection[intr.guild.id], VoiceConnectionStatus.Ready, 30_000)

    }catch(err){
      console.log(err)
      this.connection[intr.guild.id].destroy()
      throw err
    }
  }

  

  async getSpeech(intr, language, text){
    const guildID = intr.guild.id
    if (!this.connection[guildID]) { this.joinVoiceChannel(intr) }
    // else if (this.connection[guildID]._state.status == VoiceConnectionStatus.Signalling) { 
    //   console.log(`[ ${msg.guild.name} ] ðŸŽ™ Voice channel signalling.`)
    //   this.join(msg) 
    // }
    // else if (this.connection[guildID]._state.status == VoiceConnectionStatus.Connecting) { 
    //   console.log(`[ ${msg.guild.name} ] ðŸŽ™ Voice channel connecting.`)
    //   this.join(msg) 
    // }

    try {
      if(!this.playing[guildID]){
        this.playing[guildID] = text
        // let audioStr = await VoiceRSSClient.getSpeech({ 
        //   apiKey: this.key,
        //   audioFormat: "16khz_16bit_stereo",
        //   language, text,
        // })
        let audioStr = "data:;base64,UklGRkbNAQBXQVZFZm10IBIAAAABAAIAgD4AAAD6AAAEABAAAABkYXRhIM0BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP7//v8AAAAACQAJABIAEgAVABUAFgAWABgAGAAaABoAGwAbABsAGwAbABsAHQAdACEAIQAkACQAJgAmACYAJgAmACYAJQAlACYAJgAmACYAJgAmACYAJgAoACgAKgAqACoAKgApACkAKQApACkAKQAqACoAKgAqACkAKQAoACgAKAAoACgAKAAmACYAIwAjACMAIwAkACQAJAAkACQAJAAjACMAIgAiACMAIwAjACMAIwAjACIAIgAjACMAJAAkACQAJAAkACQAIwAjACIAIgAiACIAIgAiACMAIwAkACQAIwAjACIAIgAhACEAIAAgACEAIQAhACEAHgAeABoAGgAYABgAFwAXABYAFgAVABUAEwATABEAEQAPAA8ADgAOAA0ADQAMAAwACwALAAoACgAJAAkACAAIAAcABwAIAAgACgAKAAsACwAKAAoABwAHAAUABQADAAMAAgACAAIAAgABAAEAAAAAAP////8AAAAAAgACAAQABAAFAAUABQAFAAQABAADAAMAAQABAAAAAAAAAAAAAAAAAAAAAAD//////v/+//3//f/+//7/AAAAAAAAAAAAAAAAAAAAAAIAAgAGAAYACAAIAAcABwAFAAUABQAFAAYABgAIAAgACQAJAAgACAAHAAcABwAHAAYABgAEAAQAAgACAAIAAgACAAIAAgACAAIAAgABAAEAAAAAAP/////+//7//////wAAAAAAAAAAAAAAAAEAAQACAAIAAgACAAIAAgABAAEAAAAAAP////8AAAAAAgACAAMAAwABAAEAAAAAAAEAAQAEAAQABwAHAAgACAAIAAgACAAIAAoACgAMAAwADAAMAAoACgAJAAkACAAIAAgACAAIAAgABwAHAAUABQADAAMAAgACAAMAAwAEAAQABQAFAAYABgAHAAcACAAIAAkACQAKAAoACgAKAAkACQAJAAkACgAKAAwADAANAA0ACwALAAkACQAKAAoADAAMAA0ADQAOAA4ADgAOAA8ADwARABEAEgASABEAEQAQABAADwAPAA4ADgANAA0ACwALAAkACQAIAAgACAAIAAgACAAJAAkACgAKAAsACwALAAsACwALAAsACwAMAAwADQANAAwADAALAAsACwALAAsACwAKAAoACQAJAAgACAAIAAgABwAHAAYABgAGAAYABQAFAAQABAACAAIAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/////+//7//v/+//////8AAAAAAQABAAMAAwAFAAUABwAHAAYABgAGAAYACAAIAAsACwANAA0ADgAOABAAEAARABEAEgASABIAEgARABEADwAPAA4ADgAPAA8AEAAQABIAEgAUABQAFAAUABMAEwARABEAEQARABIAEgASABIAEgASABMAEwAVABUAFgAWABYAFgAXABcAFwAXABUAFQAUABQAFQAVABcAFwAWABYAFAAUABIAEgARABEAEgASABMAEwAUABQAFAAUABQAFAATABMAEwATABQAFAAWABYAFwAXABYAFgAUABQAEwATABEAEQAOAA4ACgAKAAcABwAGAAYABwAHAAcABwAEAAQAAQABAP/////+//7//v/+//////8AAAAAAAAAAAAAAAD+//7/+//7//n/+f/5//n/+v/6//n/+f/4//j/9v/2//X/9f/1//X/9v/2//n/+f/8//z//v/+//7//v/+//7//v/+//////8AAAAAAQABAAIAAgACAAIAAgACAAQABAAFAAUABQAFAAUABQAFAAUABwAHAAoACgAOAA4AEAAQABEAEQARABEAEgASABYAFgAaABoAHQAdAB0AHQAcABwAGwAbABsAGwAbABsAHQAdAB8AHwAhACEAIwAjACQAJAAkACQAJQAlACcAJwAqACoALAAsACwALAAsACwALQAtAC8ALwAxADEAMgAyADMAMwAzADMAMQAxAC8ALwAuAC4ALgAuAC0ALQAsACwAKgAqACgAKAAnACcAJgAmACYAJgAlACUAIwAjACAAIAAeAB4AHQAdABsAGwAYABgAFgAWABQAFAASABIAEQARABIAEgASABIAEQARAA4ADgAKAAoABgAGAAMAAwABAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAD//////v/+//3//f/6//r/9v/2//P/8//w//D/7P/s/+n/6f/m/+b/5P/k/+P/4//h/+H/3v/e/9z/3P/c/9z/3P/c/9v/2//Z/9n/1v/W/9T/1P/V/9X/2P/Y/9n/2f/a/9r/3P/c/93/3f/d/93/3P/c/9z/3P/d/93/3P/c/93/3f/h/+H/5f/l/+b/5v/n/+f/6f/p/+z/7P/v/+//8f/x//P/8//1//X/+f/5//7//v8BAAEAAgACAAMAAwAFAAUACQAJAAwADAAOAA4ADgAOAA4ADgAPAA8AEgASABUAFQAYABgAGgAaAB4AHgAhACEAJAAkACYAJgAoACgAKgAqAC0ALQAwADAAMAAwAC4ALgArACsAKAAoACcAJwAoACgAKgAqACsAKwApACkAJgAmACQAJAAiACIAIgAiACEAIQAeAB4AHAAcABwAHAAcABwAGgAaABYAFgATABMAEAAQAAwADAAIAAgAAwADAP/////+//7////////////+//7//v/+//7//v/+//7//v/+//z//P/6//r/+//7//7//v8AAAAAAAAAAAAAAAAAAAAAAQABAAMAAwAFAAUABwAHAAoACgAOAA4AEgASABYAFgAYABgAGgAaABwAHAAfAB8AIQAhACQAJAAnACcAKgAqACwALAAuAC4AMAAwADMAMwA2ADYAOQA5ADsAOwA8ADwAPAA8ADwAPAA+AD4AQQBBAEIAQgBCAEIAQgBCAEEAQQBBAEEAQgBCAEMAQwBCAEIAQABAAD0APQA7ADsAOgA6ADgAOAA2ADYAMwAzADEAMQAwADAALwAvAC4ALgAsACwAJwAnACMAIwAjACMAJAAkACQAJAAjACMAIQAhACAAIAAgACAAIAAgAB8AHwAeAB4AHwAfACEAIQAjACMAJAAkACMAIwAiACIAIwAjACMAIwAhACEAIAAgACEAIQAjACMAIwAjACMAIwAkACQAJgAmACgAKAAqACoAKwArACsAKwAqACoAKQApACsAKwAtAC0ALgAuAC0ALQAsACwALAAsAC0ALQAuAC4ALwAvAC4ALgAsACwAKgAqACkAKQApACkAKAAoACcAJwAmACYAJAAkACIAIgAgACAAHAAcABoAGgAbABsAGwAbABcAFwARABEADAAMAAgACAAFAAUAAwADAAAAAAD9//3/+//7//n/+f/3//f/9f/1//P/8//x//H/8P/w/+7/7v/r/+v/6f/p/+v/6//t/+3/7P/s/+r/6v/p/+n/6f/p/+r/6v/r/+v/7P/s/+z/7P/r/+v/6v/q/+r/6v/s/+z/7//v//L/8v/1//X/+P/4//z//P8AAAAABgAGAAwADAASABIAFgAWABgAGAAZABkAHAAcACAAIAAiACIAIwAjACIAIgAiACIAJgAmACsAKwAuAC4AMgAyADgAOAA+AD4AQgBCAEQARABGAEYASABIAEsASwBPAE8AUwBTAFcAVwBaAFoAXABcAGAAYABkAGQAaABoAGkAaQBpAGkAZwBnAGcAZwBmAGYAZQBlAGIAYgBfAF8AXQBdAF8AXwBfAF8AWgBaAFIAUgBNAE0ASQBJAEUARQBAAEAAOQA5ADIAMgAtAC0AKQApACQAJAAfAB8AGQAZABMAEwAQABAADQANAAkACQAGAAYABAAEAAIAAgD//////f/9//z//P/7//v/+//7//r/+v/5//n/+v/6//7//v8DAAMABQAFAAUABQAGAAYABwAHAAkACQAMAAwADQANAA4ADgAOAA4ADgAOAA4ADgAOAA4ADQANAAsACwAKAAoACgAKAAsACwAMAAwADAAMAAsACwAJAAkABgAGAAMAAwAAAAAA/P/8//r/+v/9//3///////r/+v/0//T/8//z//X/9f/4//j/+//7//z//P/7//v/+v/6//n/+f/4//j/+P/4//z//P8AAAAAAgACAAQABAAIAAgADAAMABAAEAATABMAFgAWABgAGAAbABsAHgAeACEAIQAjACMAIgAiAB8AHwAdAB0AGgAaABcAFwAUABQAEQARAA8ADwAQABAAEgASABQAFAAUABQAFAAUABQAFAAXABcAGwAbAB0AHQAeAB4AIQAhACUAJQArACsAMQAxADgAOABAAEAASgBKAFMAUwBdAF0AZgBmAHIAcgB9AH0AiACIAJIAkgCdAJ0ApgCmAK0ArQCxALEAtAC0ALgAuAC/AL8AxQDFAMcAxwDCAMIAuQC5ALAAsACuAK4ArACsAKYApgCbAJsAjgCOAIAAgABzAHMAZwBnAFoAWgBKAEoANgA2ACIAIgARABEAAQABAO//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"
        // console.log(`data:audio/ogg; codecs=opus;base64,${audioStr.split(",")[1]}`)
        const resource = createAudioResource(`data:audio/ogg; codecs=opus;base64,${audioStr.split(",")[1]}`, { 
          metadata: { title: text },
          inputType: StreamType.WebmOpus
        })
        console.log(resource, "@@")
        this.player[guildID].play(resource)
        this.dispatcher[guildID] = this.connection[guildID].subscribe(this.player[guildID])
        // await intr.reply(`ðŸ—£ ${text}`)
      }else{
        // await intr.reply('Wait for current speech')
      }
    } catch(e) {
      console.log(e)
    }
  }
}